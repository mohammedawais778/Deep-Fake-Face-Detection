<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
    <meta name="theme-color" content="#667eea">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="author" content="Deepfake Detection System">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Deep Fake Face Detection System - Detect manipulated images and videos">
    <title>Deep Fake Face Detection System</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🤖</text></svg>">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        /* Add focus styles for better keyboard navigation */
        :focus-visible {
            outline: 3px solid #4CAF50;
            outline-offset: 2px;
            border-radius: 4px;
        }
        
        /* Button loading state */
        button[aria-busy="true"] .spinner {
            display: inline-block;
            width: 1em;
            height: 1em;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-left: 8px;
            vertical-align: middle;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        button[aria-busy="true"] .btn-text::after {
            content: "...";
        }
        
        /* Error state for status bar */
        .status-bar.error {
            background-color: #f8d7da;
            border-color: #f5c6cb;
        }
        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        /* Accessibility Helpers */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        
        .error-message {
            color: #dc3545;
            margin-top: 10px;
            font-size: 0.9rem;
            display: none;
        }
        
        .error-message.visible {
            display: block;
        }
        
        /* Focus styles for keyboard navigation */
        *:focus-visible {
            outline: 3px solid #4CAF50;
            outline-offset: 2px;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .main-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            margin-bottom: 30px;
        }

        .upload-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 2rem 0;
            width: 100%;
            max-width: 800px;
            margin: 0 auto 2rem;
        }
        
        .button-group {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
            justify-content: center;
            width: 100%;
        }
        
        .button-group button {
            min-width: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Notification styles */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            transform: translateX(120%);
            transition: transform 0.3s ease-in-out;
            max-width: 350px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background-color: #10B981;
        }
        
        .notification.info {
            background-color: #3B82F6;
        }
        
        .notification.warning {
            background-color: #F59E0B;
        }
        
        .notification.error {
            background-color: #EF4444;
        }
        
        .notification-icon {
            font-size: 1.25rem;
        }

        .upload-area {
            border: 2px dashed #cbd5e0;
            border-radius: 8px;
            padding: 2.5rem 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background-color: #f8fafc;
            margin-bottom: 1.5rem;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        
        .upload-area.highlight {
            border-color: #4f46e5;
            background-color: #eef2ff;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }
        
        .upload-area p {
            margin: 0.5rem 0 0;
            color: #64748b;
        }
        
        .upload-area-icon {
            color: #94a3b8;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }
        
        .upload-area.highlight .upload-area-icon {
            color: #4f46e5;
            transform: scale(1.1);
        }
        
        .upload-area.dragover {
            border-color: #4f46e5;
            background-color: #f0f5ff;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
        }
        
        .upload-area.file-selected {
            border-color: #10B981;
            background-color: #f0fdf4;
        }

        .upload-area:hover {
            border-color: #764ba2;
            background: linear-gradient(145deg, #f0f4ff, #e0ecff);
            transform: translateY(-2px);
        }

        .upload-area.dragover {
            border-color: #4CAF50;
            background: linear-gradient(145deg, #f0fff0, #e8f8e8);
        }

        .upload-icon {
            font-size: 4rem;
            color: #667eea;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .upload-area:hover .upload-icon {
            color: #764ba2;
            transform: scale(1.1);
        }

        .upload-text {
            font-size: 1.2rem;
            color: #555;
            margin-bottom: 10px;
        }

        .upload-subtext {
            color: #888;
            font-size: 0.9rem;
        }

        #fileInput {
            display: none;
        }

        .action-buttons {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .btn-group {
            display: flex;
            gap: 10px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 30px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            min-width: 150px;
        }

        .btn-upload {
            background: linear-gradient(135deg, #4CAF50, #45a049);
        }

        .btn-analyze {
            background: linear-gradient(135deg, #ff9800, #f57c00);
        }

        .btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .btn:active:not(:disabled) {
            transform: translateY(0);
        }
        
        .btn:focus {
            outline: 2px solid #4CAF50;
            outline-offset: 2px;
        }

        .preview-section {
            margin: 30px 0;
            text-align: center;
        }

        .image-preview {
            max-width: 400px;
            max-height: 400px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin: 0 auto 20px;
            display: none;
        }

        .results-section {
            margin-top: 30px;
            padding: 30px;
            background: linear-gradient(145deg, #f8f9ff, #fff);
            border-radius: 15px;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.05);
            display: none;
        }

        .status-bar {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-icon {
            font-size: 1.2rem;
            color: #667eea;
        }

        .status-text {
            font-size: 0.9rem;
            color: #555;
        }

        .batch-progress {
            margin-top: 20px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            display: none;
        }

        .batch-progress.visible {
            display: block;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .progress-title {
            font-size: 1.1rem;
            color: #555;
        }

        .progress-status {
            font-size: 0.9rem;
            color: #667eea;
        }

        .file-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }

        .file-item:last-child {
            border-bottom: none;
        }

        .file-name {
            font-size: 0.9rem;
            color: #333;
        }

        .file-status {
            font-size: 0.8rem;
        }

        .status-pending {
            color: #f39c12;
        }

        .status-processing {
            color: #3498db;
        }

        .status-complete {
            color: #2ecc71;
        }

        .status-error {
            color: #e74c3c;
        }

        .memory-gauge {
            width: 100px;
            height: 8px;
            background: #eee;
            border-radius: 4px;
            overflow: hidden;
        }

        .memory-fill {
            height: 100%;
            background: linear-gradient(90deg, #2ecc71, #e74c3c);
            transition: width 0.3s ease;
        }

        /* Result Cards */
        .result-card {
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            border-left: 4px solid #4CAF50;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.5s ease forwards;
        }
        
        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .result-card:hover {
            transform: translateY(-3px) scale(1.01);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
        
        .result-card:focus {
            outline: 2px solid #4CAF50;
            outline-offset: 2px;
        }
        
        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.25rem;
            gap: 1rem;
        }
        
        .result-title {
            font-size: 1.15rem;
            font-weight: 600;
            color: #2c3e50;
            margin: 0;
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .result-title i {
            color: #7f8c8d;
            font-size: 1.1em;
        }
        
        .result-status {
            padding: 0.4rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }
        
        .result-status::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.2);
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        
        .result-status:hover::after {
            opacity: 1;
        }
        
        .result-status.real {
            background-color: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #c8e6c9;
        }
        
        .result-status.fake {
            background-color: #ffebee;
            color: #c62828;
            border: 1px solid #ffcdd2;
        }
        
        .result-details {
            color: #34495e;
            line-height: 1.7;
            font-size: 0.95rem;
        }
        
        .result-meta {
            margin-bottom: 0.5rem;
        }
        
        .result-details p {
            margin: 0.6rem 0;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.35rem;
        }
        
        .confidence-value {
            font-weight: 600;
            color: #2c3e50;
            margin-right: 0.5rem;
        }
        
        .confidence-bar {
            height: 6px;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            border-radius: 3px;
            margin-top: 0.25rem;
            display: block;
            transition: width 0.8s ease;
        }
        
        .model-info {
            margin-top: 1rem !important;
            padding-top: 0.75rem;
            border-top: 1px dashed #e0e0e0;
            color: #7f8c8d !important;
            font-size: 0.85rem !important;
        }
        
        /* Accessibility */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .confidence-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.8s ease;
            background: linear-gradient(90deg, #667eea, #764ba2);
        }

        .result-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .detail-item {
            text-align: center;
            padding: 15px;
            background: #f8f9ff;
            border-radius: 10px;
        }

        .detail-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }

        .detail-value {
            font-size: 1.1rem;
            font-weight: bold;
            color: #333;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 10px;
            border-left: 5px solid #f44336;
            margin: 20px 0;
            display: none;
        }

        .info-section {
            background: linear-gradient(145deg, #fff, #f8f9ff);
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }

        .info-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            text-align: center;
        }

        .info-icon {
            font-size: 3rem;
            color: #667eea;
            margin-bottom: 15px;
        }

        .info-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        .info-text {
            color: #666;
            line-height: 1.6;
        }

        .footer {
            text-align: center;
            margin-top: 50px;
            color: rgba(255,255,255,0.8);
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .main-card {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .upload-area {
                padding: 40px 20px;
            }
            
            .result-header {
                flex-direction: column;
                text-align: center;
            }
            
            .result-details {
                grid-template-columns: 1fr;
            }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <header class="header" role="banner">
        <div class="container">
            <h1><i class="fas fa-eye" aria-hidden="true"></i> Deepfake Detection System</h1>
        </div>
    </header>
    <main class="container" role="main">
        <section class="results-section" id="resultsSection" aria-labelledby="results-heading" role="region">
            <h2 id="results-heading">Analysis Results</h2>
            </div>
        </section>

        <div class="main-card">
            <section class="upload-section" aria-labelledby="upload-heading">
                <h2 id="upload-heading" class="sr-only">File Upload</h2>
                <div id="uploadArea" class="upload-area">
                    <div class="upload-area-content">
                        <i class="fas fa-cloud-upload-alt fa-3x upload-area-icon" aria-hidden="true"></i>
                        <h3>Drag & Drop your file here</h3>
                        <p>or click to browse files (Images: JPG, PNG | Videos: MP4, AVI, MOV)</p>
                        <input type="file" id="fileInput" accept="image/*,video/*" style="display: none;" multiple>
                    </div>
                </div>
                <div class="file-info" id="fileInfo"></div>
                <!-- Image and Video Previews -->
                <div id="previewContainer" style="margin: 1rem 0; text-align: center; display: none;">
                    <img id="imagePreview" style="max-width: 100%; max-height: 300px; display: none;" alt="Image preview">
                    <video id="videoPreview" controls style="max-width: 100%; max-height: 300px; display: none;" alt="Video preview"></video>
                </div>
                <div class="action-buttons">
                    <div class="btn-group" style="justify-content: center; margin: 1.5rem 0;">
                        <button type="button" class="btn" id="uploadBtn" style="margin-right: 10px;">
                            <i class="fas fa-upload" aria-hidden="true"></i> Upload
                        </button>
                        <button type="button" class="btn btn-analyze" id="analyzeBtn" disabled aria-busy="false" aria-live="polite" aria-label="Analyze files">
                            <i class="fas fa-search" aria-hidden="true"></i>
                            <span class="btn-text">Analyze</span>
                            <span class="spinner" style="display: none; margin-left: 8px;">
                                <i class="fas fa-spinner fa-spin"></i>
                            </span>
                        </button>
                    </div>
                    <div id="fileInputError" class="error-message" style="color: #e53e3e; margin-top: 0.5rem; display: none;"></div>
                    <div id="analyzeStatus" class="sr-only" role="status" aria-live="polite"></div>
                </div>

                <div class="status-bar" id="statusBar" role="status" aria-live="polite" style="display: none;">
                    <div class="status-message" id="statusMessage">Processing files... Please wait.</div>
                    <div class="progress-container" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" aria-valuetext="0% complete">
                        <div class="progress-bar" id="progressBar"></div>
                    </div>
                    <div id="statusDetails" class="sr-only" aria-live="polite"></div>
                </div>
                <div id="batchProgress" class="batch-progress">
                    <div class="progress-header">
                        <div class="progress-title">Batch Processing</div>
                        <div id="batchStatus" class="progress-status">0 / 0 files complete</div>
                    </div>
                    <div id="fileList" class="file-list">
                        <!-- File items will be added here dynamically -->
                    </div>
                </div>
            </section>

            <div id="results">
                <!-- Result cards will be added here dynamically -->
            </div>
        </div>

        <footer class="footer">
            <div class="container">
                <p>&copy; 2025 Deepfake Detection System | Powered by Advanced AI</p>
                <p class="disclaimer">For informational purposes only. Do not take action based solely on this information.</p>
            </div>
        </footer>
    </main>
    <!-- Move the script to the end of the body -->
    <script type="application/javascript">
    // Global variables
    const activeBatches = new Map();
    let statusCheckInterval = null;
    let uploadArea = null;
    let fileInput = null;
    let analyzeBtn = null;
    let uploadBtn = null;
    let imagePreview = null;
    let videoPreview = null;
    let fileList = null;
    let resultsContainer = null;
    let fileInputError = null;
    let previewContainer = null;
    let selectedFiles = [];
    let systemStatus = null;
    let statusText = null;
    
    // Global notification function
    function showNotification(message, type = 'info', duration = 3000) {
        try {
            // Create notification container if it doesn't exist
            let notificationContainer = document.getElementById('notification-container');
            if (!notificationContainer) {
                notificationContainer = document.createElement('div');
                notificationContainer.id = 'notification-container';
                notificationContainer.style.position = 'fixed';
                notificationContainer.style.top = '20px';
                notificationContainer.style.right = '20px';
                notificationContainer.style.zIndex = '10000';
                document.body.appendChild(notificationContainer);
            }
            
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.setAttribute('role', 'alert');
            notification.setAttribute('aria-live', 'polite');
            notification.style.marginBottom = '10px';
            notification.style.padding = '15px 25px';
            notification.style.borderRadius = '4px';
            notification.style.boxShadow = '0 4px 6px rgba(0,0,0,0.1)';
            notification.style.transition = 'opacity 0.3s, transform 0.3s';
            notification.style.opacity = '0';
            notification.style.transform = 'translateY(20px)';
            notification.style.maxWidth = '400px';
            notification.style.wordBreak = 'break-word';
            notification.style.position = 'relative';
            
            // Set background color based on type
            const colors = {
                info: '#e6f7ff',
                success: '#f6ffed',
                warning: '#fffbe6',
                error: '#fff1f0'
            };
            notification.style.backgroundColor = colors[type] || colors.info;
            notification.style.borderLeft = `4px solid ${type === 'error' ? '#ff4d4f' : type === 'success' ? '#52c41a' : type === 'warning' ? '#faad14' : '#1890ff'}`;
            
            // Add message
            const messageEl = document.createElement('div');
            messageEl.textContent = message;
            notification.appendChild(messageEl);
            
            // Add close button
            const closeBtn = document.createElement('button');
            closeBtn.innerHTML = '&times;';
            closeBtn.style.background = 'none';
            closeBtn.style.border = 'none';
            closeBtn.style.position = 'absolute';
            closeBtn.style.top = '5px';
            closeBtn.style.right = '10px';
            closeBtn.style.cursor = 'pointer';
            closeBtn.style.fontSize = '18px';
            closeBtn.style.color = '#666';
            closeBtn.setAttribute('aria-label', 'Close notification');
            closeBtn.onclick = () => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateY(-20px)';
                setTimeout(() => {
                    if (notification.parentNode === notificationContainer) {
                        notificationContainer.removeChild(notification);
                    }
                }, 300);
            };
            notification.appendChild(closeBtn);
            
            notificationContainer.appendChild(notification);
            
            // Trigger reflow to ensure animation plays
            void notification.offsetWidth;
            notification.style.opacity = '1';
            notification.style.transform = 'translateY(0)';
            
            // Auto-hide after duration if specified
            if (duration > 0) {
                setTimeout(() => {
                    notification.style.opacity = '0';
                    notification.style.transform = 'translateY(-20px)';
                    setTimeout(() => {
                        if (notification.parentNode === notificationContainer) {
                            notificationContainer.removeChild(notification);
                        }
                    }, 300);
                }, duration);
            }
            
            return notification;
        } catch (error) {
            console.error('Error showing notification:', error);
            // Fallback to console if DOM manipulation fails
            console.log(`[${type.toUpperCase()}] ${message}`);
            return null;
        }
    }
    
    // Helper function to show error messages
    function showError(message) {
        const errorDiv = document.getElementById('error-message');
        if (errorDiv) {
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            // Auto-hide after 5 seconds
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }
        // Also log to console
        console.error(message);
    }
    
    // Initialize DOM elements with error handling and validation
    function initializeElements() {
        console.log('Initializing elements...');
        
        // Define required elements with their IDs and purpose
        const elements = [
            { id: 'uploadArea', name: 'uploadArea', required: true },
            { id: 'fileInput', name: 'fileInput', required: true },
            { id: 'analyzeBtn', name: 'analyzeBtn', required: true },
            { id: 'uploadBtn', name: 'uploadBtn', required: true },
            { id: 'imagePreview', name: 'imagePreview', required: false },
            { id: 'videoPreview', name: 'videoPreview', required: false },
            { id: 'results', name: 'resultsContainer', required: true },
            { id: 'fileInputError', name: 'fileInputError', required: false },
            { id: 'fileList', name: 'fileList', required: true },
            { id: 'previewContainer', name: 'previewContainer', required: false }
        ];
        
        // Initialize elements and track missing required ones
        const missingElements = [];
        
        elements.forEach(element => {
            try {
                // Get the element
                const el = document.getElementById(element.id);
                
                // Store in the corresponding variable
                window[element.name] = el;
                
                // Check if required element is missing
                if (element.required && !el) {
                    missingElements.push(element.id);
                    console.error(`Required element not found: ${element.id}`);
                }
            } catch (error) {
                console.error(`Error initializing element ${element.id}:`, error);
                if (element.required) {
                    missingElements.push(element.id);
                }
            }
        });
        
        // Log initialization status
        console.log('Elements initialized:', { 
            uploadArea: !!uploadArea, 
            fileInput: !!fileInput, 
            analyzeBtn: !!analyzeBtn, 
            uploadBtn: !!uploadBtn,
            imagePreview: !!imagePreview,
            videoPreview: !!videoPreview,
            resultsContainer: !!resultsContainer,
            fileInputError: !!fileInputError,
            fileList: !!fileList,
            previewContainer: !!previewContainer
        });
        
        // Set up upload button if it exists
        if (uploadBtn && fileInput) {
            // Remove any existing listeners to prevent duplicates
            const newUploadBtn = uploadBtn.cloneNode(true);
            uploadBtn.parentNode.replaceChild(newUploadBtn, uploadBtn);
            uploadBtn = newUploadBtn;
            
            uploadBtn.addEventListener('click', (e) => {
                e.preventDefault();
                fileInput.click();
            });
        }
        
        // Set initial analyze button state
        if (analyzeBtn) {
            analyzeBtn.disabled = true;
        }
        
        // Return success only if all required elements are present
        return missingElements.length === 0;
    }
        
    // Single initialization point for the application
    function initializeApplication() {
        console.log('Starting application initialization...');
        
        // Track initialization steps
        const initSteps = [
            { name: 'DOM Elements', fn: initializeElements },
            { name: 'Event Listeners', fn: setupEventListeners },
            { name: 'Analyze Button', fn: setupAnalyzeButton },
            { name: 'Upload Area', fn: setupUploadArea },
            { name: 'System Status', fn: checkSystemStatus }
        ];
        
        try {
            // Execute each initialization step
            for (const step of initSteps) {
                console.log(`Initializing ${step.name}...`);
                const startTime = performance.now();
                
                try {
                    const result = step.fn();
                    if (result === false) {
                        throw new Error(`${step.name} initialization returned false`);
                    }
                    
                    const duration = (performance.now() - startTime).toFixed(2);
                    console.log(`✓ ${step.name} initialized in ${duration}ms`);
                } catch (stepError) {
                    console.error(`❌ Error initializing ${step.name}:`, stepError);
                    throw new Error(`Failed to initialize ${step.name}: ${stepError.message}`);
                }
            }
            
            console.log('✅ Application initialized successfully');
            
            // Show success notification
            showNotification('Application initialized successfully', 'success');
            
        } catch (error) {
            console.error('❌ Application initialization failed:', error);
            
            // Show error to user
            showError(`Initialization error: ${error.message}. Please refresh the page.`);
            
            // Try to show more detailed error in console
            console.group('Initialization Error Details');
            console.error('Error:', error);
            console.groupEnd();
            
            // Rethrow to be caught by the global error handler
            throw error;
        }
    }
        
    // Function to handle file selection
    function handleFileSelect(e) {
        try {
            console.log('File selection changed');
            
            // Clear any previous selection
            selectedFiles = [];
            
            // Get files from input or drag-and-drop
            const files = e.target.files || (e.dataTransfer ? e.dataTransfer.files : []);
            if (!files || files.length === 0) {
                console.warn('No files selected');
                return;
            }
            
            // Convert FileList to array and filter by type
            const validFiles = Array.from(files).filter(file => {
                const fileType = file.type;
                const isValid = fileType.startsWith('image/') || fileType.startsWith('video/');
                if (!isValid) {
                    console.warn(`Skipping unsupported file type: ${fileType}`);
                }
                return isValid;
            });
            
            if (validFiles.length === 0) {
                showError('Please select valid image or video files (JPG, PNG, MP4, AVI, MOV)');
                return;
            }
            
            selectedFiles = validFiles;
            updateFileInfo(selectedFiles);
            
            // Enable analyze button if we have valid files
            if (analyzeBtn) {
                analyzeBtn.disabled = selectedFiles.length === 0;
            }
            
            // Show preview if we have an image or video
            if (selectedFiles.length > 0) {
                const file = selectedFiles[0];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    if (file.type.startsWith('image/')) {
                        if (imagePreview) {
                            imagePreview.src = e.target.result;
                            imagePreview.style.display = 'block';
                            if (videoPreview) videoPreview.style.display = 'none';
                            const previewContainer = document.getElementById('previewContainer');
                            if (previewContainer) previewContainer.style.display = 'block';
                        }
                    } else if (file.type.startsWith('video/')) {
                        if (videoPreview) {
                            videoPreview.src = URL.createObjectURL(file);
                            videoPreview.style.display = 'block';
                            if (imagePreview) imagePreview.style.display = 'none';
                            const previewContainer = document.getElementById('previewContainer');
                            if (previewContainer) previewContainer.style.display = 'block';
                        }
                    }
                };
                
                if (file.type.startsWith('image/')) {
                    reader.readAsDataURL(file);
                } else if (file.type.startsWith('video/')) {
                    // For videos, we don't need to read the file, just set the source
                    reader.onload();
                }
            }
            
        } catch (error) {
            console.error('Error handling file selection:', error);
            showError('An error occurred while processing the file. Please try again.');
            
            // Clear results container if it exists
            const resultsContainer = document.getElementById('results');
            if (resultsContainer) {
                resultsContainer.innerHTML = '';
            }
        }
    }
    
    // Global notification function
    function showNotification(message, type = 'info', duration = 3000) {
        try {
            // Create notification container if it doesn't exist
            let notificationContainer = document.getElementById('notification-container');
            if (!notificationContainer) {
                notificationContainer = document.createElement('div');
                notificationContainer.id = 'notification-container';
                notificationContainer.style.position = 'fixed';
                notificationContainer.style.top = '20px';
                notificationContainer.style.right = '20px';
                notificationContainer.style.zIndex = '10000';
                document.body.appendChild(notificationContainer);
            }
            
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.setAttribute('role', 'alert');
            notification.setAttribute('aria-live', 'polite');
            
            // Configure notification styles
            notification.style.marginBottom = '10px';
            notification.style.padding = '15px 25px';
            notification.style.borderRadius = '4px';
            notification.style.boxShadow = '0 4px 6px rgba(0,0,0,0.1)';
            notification.style.transition = 'opacity 0.3s, transform 0.3s';
            notification.style.opacity = '0';
            notification.style.transform = 'translateY(20px)';
            notification.style.maxWidth = '400px';
            notification.style.wordBreak = 'break-word';
            notification.style.position = 'relative';
            
            // Set type-specific styles
            const typeStyles = {
                success: { backgroundColor: '#48bb78', color: 'white' },
                error: { backgroundColor: '#f56565', color: 'white' },
                warning: { backgroundColor: '#ed8936', color: 'white' },
                info: { backgroundColor: '#4299e1', color: 'white' }
            };
            
            Object.assign(notification.style, typeStyles[type] || typeStyles.info);
            
            // Add message content
            notification.textContent = message;
            
            // Add close button
            const closeButton = document.createElement('button');
            closeButton.innerHTML = '&times;';
            closeButton.style.background = 'none';
            closeButton.style.border = 'none';
            closeButton.style.color = 'white';
            closeButton.style.fontSize = '18px';
            closeButton.style.position = 'absolute';
            closeButton.style.top = '5px';
            closeButton.style.right = '10px';
            closeButton.style.cursor = 'pointer';
            closeButton.setAttribute('aria-label', 'Close notification');
            closeButton.onclick = () => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateY(-20px)';
                setTimeout(() => {
                    if (notification.parentNode === notificationContainer) {
                        notificationContainer.removeChild(notification);
                    }
                }, 300);
            };
            notification.appendChild(closeButton);
            
            // Add to container
            notificationContainer.appendChild(notification);
            
            // Trigger reflow to ensure animation plays
            void notification.offsetWidth;
            notification.style.opacity = '1';
            notification.style.transform = 'translateY(0)';
            
            // Auto-remove after duration if specified
            if (duration > 0) {
                setTimeout(() => {
                    notification.style.opacity = '0';
                    notification.style.transform = 'translateY(-20px)';
                    setTimeout(() => {
                        if (notification.parentNode === notificationContainer) {
                            notificationContainer.removeChild(notification);
                        }
                    }, 300);
                }, duration);
            }
            
            return notification;
            
        } catch (error) {
            console.error('Error showing notification:', error);
            // Fallback to console if DOM manipulation fails
            console.log(`[${type.toUpperCase()}] ${message}`);
            return null;
        }
    }
        
        
        // Handle drag over
        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }
        
        function highlight(e) {
            preventDefaults(e);
            updateUploadAreaFeedback();
        }
        
        function updateUploadAreaFeedback() {
            const uploadArea = document.getElementById('uploadArea');
            if (uploadArea) {
                uploadArea.classList.add('file-selected');
            }
            
            // Reset results if any
            const resultsContainer = document.getElementById('results');
            if (resultsContainer) {
                resultsContainer.innerHTML = '';
            }
        }
        
        function unhighlight(e) {
            preventDefaults(e);
            const uploadArea = document.getElementById('uploadArea');
            if (uploadArea) {
                uploadArea.classList.remove('dragover');
            }
        }
        
        function handleDrop(e) {
            console.log('File drop event');
            preventDefaults(e);
            unhighlight(e);
            
            const uploadArea = document.getElementById('uploadArea');
            if (!uploadArea) {
                console.error('Upload area not found');
                return;
            }
            
            console.log('Upload area found, adding file-selected class');
            uploadArea.classList.add('file-selected');
            
            const dt = e.dataTransfer;
            if (!dt) {
                console.error('No dataTransfer object in drop event');
                return;
            }
            
            const files = dt.files;
            console.log('Dropped files:', files);
            
            if (files && files.length > 0) {
                // Clear any existing files from the input
                if (fileInput) {
                    fileInput.value = '';
                }
                // Convert FileList to array for easier handling
                const fileArray = Array.from(files);
                console.log('Converted to array:', fileArray);
                handleFiles(fileArray);
            } else {
                console.warn('No files found in drop event');
            }
        }
        
        function handleFiles(files) {
            console.log('handleFiles called with:', files);
            if (!files || !files.length) {
                console.error('No files provided to handleFiles');
                return;
            }
            
            // Clear any existing previews
            const imagePreview = document.getElementById('imagePreview');
            const videoPreview = document.getElementById('videoPreview');
            const previewContainer = document.getElementById('previewContainer');
            if (imagePreview) imagePreview.style.display = 'none';
            if (videoPreview) videoPreview.style.display = 'none';
            if (previewContainer) previewContainer.style.display = 'none';
            
            // Clear any existing file info
            const fileInfo = document.getElementById('fileInfo');
            if (fileInfo) fileInfo.innerHTML = '';
            
            // Filter for valid file types
            const validFiles = files.filter(file => {
                const fileType = file.type || '';
                console.log('Checking file:', file.name, 'Type:', fileType);
                return fileType.startsWith('image/') || fileType.startsWith('video/');
            });
            
            console.log('Valid files after filtering:', validFiles);
            
            if (validFiles.length === 0) {
                showError('Please select valid image or video files (JPG, PNG, MP4, AVI, MOV)');
                return;
            }
            
            // Store only the first file (single file upload)
            selectedFiles = [validFiles[0]];
            
            // Update UI
            updateFileInfo(selectedFiles);
            
            // Enable analyze button
            if (analyzeBtn) {
                analyzeBtn.disabled = false;
            }
            
            // Show preview for the selected file
            const file = selectedFiles[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                if (file.type.startsWith('image/') && imagePreview) {
                    imagePreview.src = e.target.result;
                    imagePreview.style.display = 'block';
                    if (previewContainer) previewContainer.style.display = 'block';
                } else if (file.type.startsWith('video/') && videoPreview) {
                    videoPreview.src = URL.createObjectURL(file);
                    videoPreview.style.display = 'block';
                    if (previewContainer) previewContainer.style.display = 'block';
                }
            };
            
            if (file.type.startsWith('image/')) {
                reader.readAsDataURL(file);
            } else if (file.type.startsWith('video/')) {
                // For videos, we don't need to read the file, just set the source
                reader.onload();
            }
        }
        
        function handleDragLeave(e) {
            e.preventDefault();
            e.stopPropagation();
            if (uploadArea) {
                uploadArea.classList.remove('dragover');
            }
        }
        
        // Handle upload area keydown
        function handleUploadAreaKeydown(e) {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                if (fileInput) fileInput.click();
            }
        }
        
        // Update file list in the UI
        function updateFileInfo(files) {
            const fileInfo = document.getElementById('fileInfo');
            const uploadArea = document.getElementById('uploadArea');
            
            if (!fileInfo || !uploadArea) return;
            
            if (files.length === 0) {
                fileInfo.textContent = '';
                uploadArea.classList.remove('file-selected');
                return;
            }
            
            const file = files[0];
            const fileSize = (file.size / (1024 * 1024)).toFixed(2); // Convert to MB
            const fileType = file.type.split('/')[0]; // 'image' or 'video'
            
            // Update file info display
            fileInfo.innerHTML = `
                <div class="file-preview">
                    <i class="fas fa-${fileType === 'video' ? 'video' : 'image'} fa-lg" style="margin-right: 8px;"></i>
                    <div style="text-align: left;">
                        <div style="font-weight: 600; margin-bottom: 4px;">${file.name}</div>
                        <div style="font-size: 0.875rem; color: #666;">${fileSize} MB • ${fileType.toUpperCase()}</div>
                    </div>
                </div>
            `;
            
            // Show preview if it's an image
            if (fileType === 'image') {
                const reader = new FileReader();
                reader.onload = function(e) {
                    fileInfo.innerHTML += `
                        <div style="margin-top: 12px; border-radius: 4px; overflow: hidden; max-width: 300px; margin: 12px auto 0;">
                            <img src="${e.target.result}" alt="Preview" style="max-width: 100%; border-radius: 4px;">
                        </div>
                    `;
                };
                reader.readAsDataURL(file);
            }
            
            // Show upload button
            const uploadBtn = document.getElementById('uploadBtn');
            if (uploadBtn) {
                uploadBtn.style.display = 'inline-flex';
            }
            
            // Disable analyze button until upload is complete
            const analyzeBtn = document.getElementById('analyzeBtn');
            if (analyzeBtn) {
                analyzeBtn.disabled = true;
            }
        }
        
        // Update file information in the UI
        function updateFileInfo(files) {
            const fileInfo = document.getElementById('fileInfo');
            const uploadArea = document.getElementById('uploadArea');
            
            if (!fileInfo || !uploadArea) return;
            
            if (files.length === 0) {
                fileInfo.textContent = '';
                uploadArea.classList.remove('file-selected');
                return;
            }
            
            const file = files[0];
            const fileSize = (file.size / (1024 * 1024)).toFixed(2); // Convert to MB
            const fileType = file.type.split('/')[0]; // 'image' or 'video'
            
            // Update file info display
            fileInfo.innerHTML = `
                <div class="file-preview">
                    <i class="fas fa-${fileType === 'video' ? 'video' : 'image'} fa-lg" style="margin-right: 8px;"></i>
                    <div style="text-align: left;">
                        <div style="font-weight: 600; margin-bottom: 4px;">${file.name}</div>
                        <div style="font-size: 0.875rem; color: #666;">${fileSize} MB • ${fileType.toUpperCase()}</div>
                    </div>
                </div>
            `;
            
            // Show preview if it's an image
            if (fileType === 'image') {
                const reader = new FileReader();
                reader.onload = function(e) {
                    fileInfo.innerHTML += `
                        <div style="margin-top: 12px; border-radius: 4px; overflow: hidden; max-width: 300px; margin: 12px auto 0;">
                            <img src="${e.target.result}" alt="Preview" style="max-width: 100%; border-radius: 4px;">
                        </div>
                    `;
                };
                reader.readAsDataURL(file);
            }
            
            // Show upload button
            const uploadBtn = document.getElementById('uploadBtn');
            if (uploadBtn) {
                uploadBtn.style.display = 'inline-flex';
            }
            
            // Enable analyze button
            const analyzeBtn = document.getElementById('analyzeBtn');
            if (analyzeBtn) {
                analyzeBtn.disabled = false;
            }
        }
        
        // Update file list in the UI
        function updateFileList() {
            if (!fileList) return;
            
            const files = fileInput?.files || [];
            if (files.length === 0) {
                fileList.innerHTML = '<p class="no-files">No files selected</p>';
                return;
            }
            
            const fileItems = Array.from(files).map((file, index) => `
                <div class="file-item">
                    <span class="file-name">${file.name}</span>
                    <span class="file-size">(${(file.size / 1024).toFixed(2)} KB)</span>
                    <button class="remove-file" data-index="${index}" aria-label="Remove file">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `).join('');
            
            fileList.innerHTML = fileItems;
            
            // Add event listeners to remove buttons
            document.querySelectorAll('.remove-file').forEach(button => {
                button.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const index = parseInt(e.currentTarget.dataset.index);
                    removeFile(index);
                });
            });
        }
        
        // Remove file from the file list
        function removeFile(index) {
            if (!fileInput || !fileInput.files) return;
            
            const dt = new DataTransfer();
            const files = Array.from(fileInput.files);
            files.splice(index, 1);
            
            files.forEach(file => dt.items.add(file));
            fileInput.files = dt.files;
            updateFileList();
        }
        
        // Set up event listeners
        function setupEventListeners() {
            console.log('Setting up event listeners...');
            
            // Get fresh references to elements
            uploadArea = document.getElementById('uploadArea');
            fileInput = document.getElementById('fileInput');
            analyzeBtn = document.getElementById('analyzeBtn');
            uploadBtn = document.getElementById('uploadBtn');
            
            if (!uploadArea || !fileInput || !analyzeBtn || !uploadBtn) {
                const missing = [];
                if (!uploadArea) missing.push('uploadArea');
                if (!fileInput) missing.push('fileInput');
                if (!analyzeBtn) missing.push('analyzeBtn');
                if (!uploadBtn) missing.push('uploadBtn');
                console.error('Required elements not found:', missing.join(', '));
                return false;
            }
            
            console.log('All elements found, proceeding with event listeners');
            
            console.log('All required elements found');
            
            try {
                // Remove any existing event listeners to prevent duplicates
                const newUploadArea = uploadArea.cloneNode(true);
                const newFileInput = fileInput.cloneNode(true);
                const newAnalyzeBtn = analyzeBtn.cloneNode(true);
                const newUploadBtn = uploadBtn.cloneNode(true);
                
                uploadArea.parentNode.replaceChild(newUploadArea, uploadArea);
                fileInput.parentNode.replaceChild(newFileInput, fileInput);
                analyzeBtn.parentNode.replaceChild(newAnalyzeBtn, analyzeBtn);
                uploadBtn.parentNode.replaceChild(newUploadBtn, uploadBtn);
                
                // Update references
                uploadArea = newUploadArea;
                fileInput = newFileInput;
                analyzeBtn = newAnalyzeBtn;
                uploadBtn = newUploadBtn;
                
                // Re-initialize elements after cloning
                initializeElements();
                
                // Set initial button state
                analyzeBtn.disabled = true;
                
                // Upload area interactions
                console.log('Setting up upload area event listeners');
                uploadArea.addEventListener('keydown', handleUploadAreaKeydown);
                uploadArea.addEventListener('click', function(e) {
                    console.log('Upload area clicked');
                    if (fileInput) {
                        console.log('Triggering file input click');
                        fileInput.click();
                    } else {
                        console.error('File input not found when upload area was clicked');
                    }
                });
                
                // Make sure upload button works
                uploadBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('Upload button clicked');
                    if (fileInput) {
                        console.log('Triggering file input click from button');
                        fileInput.click();
                    } else {
                        console.error('File input not found when upload button was clicked');
                    }
                });
                
                // Set up drag and drop event listeners
                ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                    uploadArea.addEventListener(eventName, preventDefaults, false);
                    document.body.addEventListener(eventName, preventDefaults, false);
                });

                // Highlight drop zone when item is dragged over it
                ['dragenter', 'dragover'].forEach(eventName => {
                    uploadArea.addEventListener(eventName, highlight, false);
                });

                // Remove highlight when item leaves drop zone
                ['dragleave', 'drop'].forEach(eventName => {
                    uploadArea.addEventListener(eventName, unhighlight, false);
                });

                // Handle file drop
                uploadArea.addEventListener('drop', handleDrop, false);
                
                // File input change handler with improved error handling
                fileInput.addEventListener('change', function(e) {
                    console.log('File input change event triggered');
                    try {
                        if (e.target.files && e.target.files.length > 0) {
                            console.log('Files selected via file input:', e.target.files);
                            const fileArray = Array.from(e.target.files);
                            console.log('Converted to array:', fileArray);
                            handleFiles(fileArray);
                        } else {
                            console.warn('No files selected or file input empty');
                        }
                    } catch (error) {
                        console.error('Error handling file input change:', error);
                        showError('Error processing selected files. Please try again.');
                    }
                });
                
                // Set up analyze button
                setupAnalyzeButton();
                
                // Initialize file list
                updateFileList();
                
                return true;
            } catch (error) {
                console.error('Error setting up event listeners:', error);
                return false;
            }
        }
        
        function setupAnalyzeButton() {
            // Get fresh reference to the analyze button
            analyzeBtn = document.getElementById('analyzeBtn');
            
            if (!analyzeBtn) {
                console.error('Analyze button not found');
                return false;
            }
            
            // Remove any existing click handlers by cloning and replacing
            const newAnalyzeBtn = analyzeBtn.cloneNode(true);
            analyzeBtn.parentNode.replaceChild(newAnalyzeBtn, analyzeBtn);
            analyzeBtn = newAnalyzeBtn; // Update the global reference
            
            console.log('Setting up analyze button click handler');
            
            analyzeBtn.addEventListener('click', async (e) => {
                console.log('Analyze button clicked');
                if (analyzeBtn.disabled) {
                    console.log('Analyze button is disabled');
                    return;
                }
                e.preventDefault();
                e.stopPropagation();
                
                if (!selectedFiles || selectedFiles.length === 0) {
                    console.warn('No files selected for analysis');
                    showNotification('Please select a file first', 'warning');
                    return;
                }
                
                // Show analyzing notification
                const notification = showNotification('Analyzing file...', 'info', 0);
                analyzeBtn.disabled = true;
                analyzeBtn.setAttribute('aria-busy', 'true');
                
                // Show spinner
                const spinner = analyzeBtn.querySelector('.spinner');
                const btnText = analyzeBtn.querySelector('.btn-text');
                if (spinner) spinner.style.display = 'inline-block';
                if (btnText) btnText.textContent = 'Analyzing...';
                
                try {
                    // Process files
                    await processFiles(selectedFiles);
                    
                    // Update notification to success
                    if (notification) {
                        notification.innerHTML = `
                            <span class="notification-icon" aria-hidden="true">✓</span>
                            <span>Analysis complete!</span>
                        `;
                        notification.className = 'notification success show';
                        
                        // Auto hide after delay
                        setTimeout(() => {
                            if (document.body.contains(notification)) {
                                notification.classList.remove('show');
                                setTimeout(() => {
                                    if (document.body.contains(notification)) {
                                        document.body.removeChild(notification);
                                    }
                                }, 300);
                            }
                        }, 2000);
                    }
                } catch (error) {
                    console.error('Error processing files:', error);
                    showNotification('Error analyzing file: ' + error.message, 'error');
                } finally {
                    // Reset button state
                    if (spinner) spinner.style.display = 'none';
                    if (btnText) btnText.textContent = 'Analyze';
                    if (analyzeBtn) {
                        analyzeBtn.disabled = false;
                        analyzeBtn.setAttribute('aria-busy', 'false');
                    }
                }
            });
        }
        
        function handleUploadAreaKeydown(e) {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                fileInput.click();
            }
        }
        
        function handleDragOver(e) {
            e.preventDefault();
            e.stopPropagation();
            uploadArea.classList.add('dragover');
            uploadArea.setAttribute('aria-dropeffect', 'copy');
        }
        
        function handleDragLeave(e) {
            e.preventDefault();
            e.stopPropagation();
            uploadArea.classList.remove('dragover');
            uploadArea.removeAttribute('aria-dropeffect');
        }
        
        function showError(message) {
            const errorDiv = document.getElementById('error-message');
            if (!errorDiv) return;
            
            errorDiv.textContent = message;
            errorDiv.classList.add('visible');
            errorDiv.setAttribute('role', 'alert');
            errorDiv.setAttribute('aria-live', 'assertive');
            
            // Auto-hide after 8 seconds
            const hideTimeout = setTimeout(() => {
                errorDiv.classList.remove('visible');
                errorDiv.removeAttribute('role');
                errorDiv.removeAttribute('aria-live');
            }, 8000);
            
            // Clear timeout if user interacts with the error
            const clearError = () => {
                clearTimeout(hideTimeout);
                errorDiv.classList.remove('visible');
                errorDiv.removeAttribute('role');
                errorDiv.removeAttribute('aria-live');
                errorDiv.removeEventListener('click', clearError);
            };
            
            errorDiv.addEventListener('click', clearError, { once: true });
            
            // Log to console
            console.error('User error:', message);
            
            // Log to analytics if available
            if (window.analytics) {
                window.analytics.track('Error', {
                    message: message,
                    location: 'file_upload',
                    timestamp: new Date().toISOString()
                });
            }
        }
        
        // Initialize the application
        // Set up the upload area
        function setupUploadArea() {
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');
            const uploadBtn = document.getElementById('uploadBtn');
            const analyzeBtn = document.getElementById('analyzeBtn');

            // Handle click on upload area
            uploadArea.addEventListener('click', () => {
                fileInput.click();
            });
            
            // Handle keyboard events for accessibility
            uploadArea.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    fileInput.click();
                }
            });
            
            uploadArea.setAttribute('tabindex', '0');
            uploadArea.setAttribute('role', 'button');
            uploadArea.setAttribute('aria-label', 'Upload area. Drag and drop files here or click to browse.');
            
            // Handle analyze button click - using event delegation
            document.addEventListener('click', async (e) => {
                if (e.target.closest('#analyzeBtn')) {
                    const analyzeButton = document.getElementById('analyzeBtn');
                    if (!analyzeButton || analyzeButton.disabled || selectedFiles.length === 0) return;
                    
                    // Show analyzing notification
                    const notification = showNotification('Analyzing file...', 'info', 0);
                    analyzeButton.disabled = true;
                    analyzeButton.setAttribute('aria-busy', 'true');
                    
                    // Show spinner
                    const spinner = analyzeButton.querySelector('.spinner');
                    const btnText = analyzeButton.querySelector('.btn-text');
                    if (spinner) spinner.style.display = 'inline-block';
                    if (btnText) btnText.textContent = 'Analyzing...';
                    
                    try {
                        // Process files
                        await processFiles(selectedFiles);
                        
                        // Update notification to success
                        if (notification) {
                            notification.innerHTML = `
                                <span class="notification-icon" aria-hidden="true">✓</span>
                                <span>Analysis complete!</span>
                            `;
                            notification.className = 'notification success show';
                            
                            // Auto hide after delay
                            setTimeout(() => {
                                if (document.body.contains(notification)) {
                                    notification.classList.remove('show');
                                    setTimeout(() => {
                                        if (document.body.contains(notification)) {
                                            document.body.removeChild(notification);
                                        }
                                    }, 300);
                                }
                            }, 2000);
                        }
                    } catch (error) {
                        console.error('Error processing files:', error);
                        showNotification('Error analyzing file', 'error');
                    } finally {
                        // Reset button state
                        if (spinner) spinner.style.display = 'none';
                        if (btnText) btnText.textContent = 'Analyze';
                        analyzeButton.disabled = false;
                        analyzeButton.setAttribute('aria-busy', 'false');
                    }
                }
            });
            
            // Reset file input to allow selecting the same file again
            fileInput.value = '';
            
            // Set up accessible labels and instructions
            const instructions = uploadArea.querySelector('.upload-text');
            if (instructions) {
                instructions.id = 'upload-instructions';
                uploadArea.setAttribute('aria-labelledby', 'upload-instructions');
            }
        }

        function updateProgress(progress) {
            const progressBar = document.getElementById('progressBar');
            const progressContainer = progressBar.parentElement;
            progressBar.style.width = progress + '%';
            progressContainer.setAttribute('aria-valuenow', progress);
            progressContainer.setAttribute('aria-valuetext', `${progress}% complete`);
            
            // Update live region for screen readers
            const statusDetails = document.getElementById('statusDetails');
            if (statusDetails) {
                statusDetails.textContent = `Progress: ${progress}%`;
            }
        }

        // Validate uploaded files
        function validateFiles(files) {
            const MAX_SIZE = 50 * 1024 * 1024; // 50MB
            const ALLOWED_TYPES = [
                'image/jpeg', 
                'image/png', 
                'video/mp4', 
                'video/avi',
                'video/quicktime'
            ];
            
            const validFiles = [];
            const invalidFiles = [];
            
            if (!files || files.length === 0) {
                return { validFiles, invalidFiles };
            }
            
            Array.from(files).forEach(file => {
                if (!file) return;
                
                const fileExt = file.name.split('.').pop().toLowerCase();
                const isImage = file.type.startsWith('image/');
                const isVideo = file.type.startsWith('video/');
                const isValidType = ALLOWED_TYPES.includes(file.type) || 
                                 (isImage && ['jpg', 'jpeg', 'png'].includes(fileExt)) ||
                                 (isVideo && ['mp4', 'avi', 'mov'].includes(fileExt));
                const isValidSize = file.size <= MAX_SIZE;
                
                if (isValidType && isValidSize) {
                    validFiles.push(file);
                } else {
                    invalidFiles.push({
                        name: file.name,
                        type: !isValidType ? 'invalid_type' : 'invalid_size',
                        size: file.size,
                        error: !isValidType ? 'File type not supported' : 'File size exceeds limit'
                    });
                }
            });
            
            return { validFiles, invalidFiles };
        }
        
        // Show file validation errors
        function showFileErrors(invalidFiles) {
            if (!invalidFiles || invalidFiles.length === 0) return;
            
            const errorMessages = invalidFiles.map(file => {
                if (file.type === 'invalid_type') {
                    return `Unsupported file type: ${file.name}`;
                } else if (file.type === 'invalid_size') {
                    const sizeMB = (file.size / (1024 * 1024)).toFixed(2);
                    return `File too large (${sizeMB}MB): ${file.name} - Max 50MB`;
                }
                return `Invalid file: ${file.name}`;
            });
            
            if (errorMessages.length > 0) {
                showError(errorMessages.join('\n'));
            }
        }
        
        function processUploadedFiles() {
            const files = fileInput.files;
            if (!files || files.length === 0) {
                showError('Please select files to analyze');
                return;
            }
            processFiles(files);
        }
        
        // Process files for analysis
        function processFiles(files) {
            if (!files || files.length === 0) {
                console.error('No files provided for processing');
                return;
            }
            
            // Convert FileList to array if needed
            const filesArray = Array.from(files || []);
            
            if (filesArray.length === 0) {
                console.error('No valid files to process');
                return;
            }
            
            // Reset previous state
            resetFilePreviews();
            
            // Validate files
            const { validFiles, invalidFiles } = validateFiles(files);
            
            // Show errors for invalid files
            if (invalidFiles.length > 0) {
                showFileErrors(invalidFiles);
            }
            
            // Process valid files
            if (validFiles.length === 0) {
                console.warn('No valid files to process');
                return;
            }
            
            // Process each file
            Array.from(files).forEach((file, index) => {
                const reader = new FileReader();
                const fileId = `file-${Date.now()}-${index}`;
                
                reader.onloadstart = () => {
                    // Show loading state for this file
                    updateFileStatus(fileId, {
                        name: file.name,
                        status: 'uploading',
                        progress: 0
                    });
                };
                
                reader.onprogress = (e) => {
                    if (e.lengthComputable) {
                        const progress = Math.round((e.loaded / e.total) * 100);
                        updateFileStatus(fileId, { progress });
                    }
                };
                
                reader.onload = (e) => {
                    try {
                        const result = e.target.result;
                        
                        // Update file status
                        updateFileStatus(fileId, {
                            status: 'processing',
                            progress: 100
                        });
                        
                        // Show preview based on file type
                        if (file.type.startsWith('image/')) {
                            showImagePreview(file, result, fileId);
                            reader.readAsDataURL(file);
                        } else if (file.type.startsWith('video/')) {
                            // For videos, we'll just create a preview from the first frame
                            showVideoPreview(file, result, fileId);
                            reader.readAsDataURL(file);
                        }
                        
                        // Add file to active processing
                        activeBatches.set(fileId, {
                            file,
                            status: 'uploading',
                            progress: 0
                        });
                    } catch (error) {
                        console.error('Error processing file:', error);
                        updateFileStatus(fileId, {
                            status: 'error',
                            error: 'Failed to process file'
                        });
                    }
                };
                
                // Start reading the file
                if (file.type.startsWith('image/') || file.type.startsWith('video/')) {
                    reader.readAsDataURL(file);
                }
            });
        }

        // Handle file drop
        function handleFileDrop(e) {
            e.preventDefault();
            const uploadArea = document.getElementById('uploadArea');
            uploadArea.classList.remove('dragover');
            
            const files = Array.from(e.dataTransfer.files);
            const { validFiles, invalidFiles } = validateFiles(files);
            
            if (invalidFiles.length > 0) {
                showFileErrors(invalidFiles);
            }
            
            if (validFiles.length > 0) {
                uploadedFiles = [...uploadedFiles, ...validFiles];
                updateFileList();
                updateAnalyzeButton();
                showSuccessMessage(`${validFiles.length} file(s) added`);
            }
        }

        // Process uploaded files
        async function processFiles(files) {
            console.log('processFiles called with:', files);
            
            try {
                // Convert FileList to array if needed
                let filesArray = [];
                
                if (files instanceof FileList) {
                    console.log('Converting FileList to array');
                    filesArray = Array.from(files);
                } else if (Array.isArray(files)) {
                    console.log('Using files array directly');
                    filesArray = files;
                } else {
                    console.error('Invalid files argument:', files);
                    throw new Error('Invalid files provided');
                }
                
                console.log('Processing files:', filesArray.map(f => ({
                    name: f.name,
                    type: f.type,
                    size: f.size
                })));
                
                // Validate files
                const validFiles = filesArray.filter(file => {
                    if (!file || typeof file !== 'object') {
                        console.error('Invalid file object:', file);
                        return false;
                    }
                    
                    const isValid = file.name && 
                                 file.size !== undefined && 
                                 file.type;
                    
                    if (!isValid) {
                        console.error('File missing required properties:', file);
                        return false;
                    }
                    
                    const validTypes = ['image/jpeg', 'image/png', 'video/mp4', 'video/avi'];
                    const validSize = file.size <= 50 * 1024 * 1024; // 50MB
                    
                    if (!validTypes.includes(file.type)) {
                        console.log(`Invalid file type: ${file.type} for ${file.name}`);
                    }
                    if (!validSize) {
                        console.log(`File too large: ${file.name} (${(file.size / (1024 * 1024)).toFixed(2)}MB)`);
                    }
                    
                    return validTypes.includes(file.type) && validSize;
                });

                console.log('Valid files:', validFiles.map(f => f.name));

                if (validFiles.length === 0) {
                    const errorMsg = 'Please upload valid image or video files (JPEG, PNG, MP4, AVI) under 50MB';
                    console.warn(errorMsg);
                    alert(errorMsg);
                    return;
                }

                const formData = new FormData();
                if (validFiles.length === 1) {
                    formData.append('file', validFiles[0]);
                } else {
                    validFiles.forEach(file => formData.append('files', file));
                }
                
                return processFormData(formData, validFiles);
                
            } catch (error) {
                console.error('Error processing files:', error);
                showError(`Error: ${error.message || 'Failed to process files'}`);
            }
        }
        
        // Process form data and submit to server
        async function processFormData(formData, validFiles) {
            const uploadButton = document.getElementById('uploadButton');
            const uploadProgress = document.getElementById('uploadProgress');
            const uploadStatus = document.getElementById('uploadStatus');
            const analyzeBtn = document.getElementById('analyzeBtn');
            
            try {
                // Update UI for upload in progress
                if (uploadButton) uploadButton.disabled = true;
                if (analyzeBtn) analyzeBtn.disabled = true;
                
                updateStatus('Processing your file...', 'processing');
                
                console.log('Submitting form data with files:', validFiles.map(f => ({
                    name: f.name,
                    type: f.type,
                    size: f.size
                })));
                
                // Show progress bar
                updateProgress(30);
                
                const response = await fetch('/api/detect', {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                // Update progress after receiving response
                updateProgress(60);
                
                const responseData = await response.json();
                console.log('Server response:', responseData);
                
                // Check for API errors
                if (!response.ok) {
                    const errorMsg = responseData.message || responseData.error || 
                                    `Server returned ${response.status}: ${response.statusText}`;
                    throw new Error(errorMsg);
                }
                
                // Check for business logic errors
                if (responseData.status !== 'success' || !responseData.data) {
                    throw new Error(responseData.message || 'Invalid response from server');
                }
                
                // Update progress to complete
                updateProgress(100);
                
                // Show success message
                updateStatus('Analysis complete!', 'success');
                
                // Show the result
                showResult(responseData.data);
                
                return responseData.data;
                
            } catch (error) {
                console.error('Error in processFormData:', error);
                
                // Update UI for error
                updateStatus(`Error: ${error.message || 'Processing failed'}`, 'error');
                
                // Show error to user
                showError(error.message || 'Failed to process the file. Please try again.');
                
                // Re-throw to be caught by the caller if needed
                throw error;
                
            } finally {
                // Reset UI
                if (uploadButton) uploadButton.disabled = false;
                if (analyzeBtn) analyzeBtn.disabled = false;
                
                // Keep progress bar visible for a moment before hiding
                setTimeout(() => {
                    resetUploadUI();
                }, 3000);
            }
            
            // Helper functions for UI updates
            function updateStatus(message, status = '') {
                if (uploadStatus) {
                    uploadStatus.textContent = message;
                    uploadStatus.className = 'status-text' + (status ? ` ${status}` : '');
                    
                    // Make sure it's visible
                    uploadStatus.style.display = 'block';
                    uploadStatus.setAttribute('aria-live', 'polite');
                }
            }
            
            function updateProgress(value) {
                if (uploadProgress) {
                    uploadProgress.style.display = 'block';
                    uploadProgress.value = value;
                    uploadProgress.setAttribute('aria-valuenow', value);
                    uploadProgress.setAttribute('aria-valuetext', `${value}% complete`);
                }
            }
            
            function resetUploadUI() {
                if (uploadProgress) {
                    uploadProgress.style.display = 'none';
                    uploadProgress.value = 0;
                    uploadProgress.removeAttribute('aria-valuenow');
                    uploadProgress.removeAttribute('aria-valuetext');
                }
                
                if (uploadStatus) {
                    if (!uploadStatus.className.includes('error')) {
                        uploadStatus.textContent = 'Ready for upload';
                    }
                    uploadStatus.className = 'status-text';
                    uploadStatus.removeAttribute('aria-live');
                }
            }
        }

        // Show batch progress UI
        function showBatchProgress(batchId, files) {
            const batchProgress = document.getElementById('batchProgress');
            const fileList = document.getElementById('fileList');
            const batchStatus = document.getElementById('batchStatus');

            batchProgress.classList.add('visible');
            batchStatus.textContent = `0 / ${files.length} files complete`;

            fileList.innerHTML = '';
            files.forEach(file => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <div class="file-name">${file.name}</div>
                    <div class="file-status status-pending">Pending</div>
                `;
                fileList.appendChild(fileItem);
            });

            activeBatches.set(batchId, {
                files: files,
                elements: Array.from(fileList.children)
            });
        }

        // Start checking batch status
        function startBatchStatusCheck(batchId) {
            if (!statusCheckInterval) {
                statusCheckInterval = setInterval(() => {
                    checkActiveBatches();
                }, 2000);
            }
        }

        // Check status of all active batches
        async function checkActiveBatches() {
            if (activeBatches.size === 0) {
                clearInterval(statusCheckInterval);
                statusCheckInterval = null;
                return;
            }

            for (const [batchId, batch] of activeBatches) {
                try {
                    const response = await fetch(`/api/batch-status/${batchId}`);
                    const data = await response.json();
                    
                    if (data.success) {
                        updateBatchProgress(batchId, data);
                        if (data.completed) {
                            showBatchResults(batchId, data.results);
                            activeBatches.delete(batchId);
                        }
                    }
                } catch (error) {
                    console.error('Error checking batch status:', error);
                }
            }
        }

        // Update batch progress UI
        function updateBatchProgress(batchId, data) {
            const batch = activeBatches.get(batchId);
            if (!batch) return;

            const batchStatus = document.getElementById('batchStatus');
            const completedCount = data.results ? data.results.length : 0;
            batchStatus.textContent = `${completedCount} / ${batch.files.length} files complete`;

            if (data.results) {
                data.results.forEach((result, index) => {
                    if (batch.elements[index]) {
                        const statusElement = batch.elements[index].querySelector('.file-status');
                        statusElement.className = `file-status status-${result.success ? 'complete' : 'error'}`;
                        statusElement.textContent = result.success ? 'Complete' : 'Error';
                    }
                });
            }
        }

        // Show batch results
        function showBatchResults(batchId, results) {
            const resultsContainer = document.getElementById('results');
            results.forEach(result => {
                if (result.success) {
                    const resultCard = document.createElement('div');
                    resultCard.className = 'result-card';
                    resultCard.innerHTML = `
                        <div class="result-header">
                            <div class="result-title">${result.file_path}</div>
                            <div class="result-status">${result.label}</div>
                        </div>
                        <div>
                            <p>Confidence: ${result.confidence_percentage}</p>
                            <p>Size: ${formatFileSize(result.file_size)}</p>
                            <p>Dimensions: ${result.image_dimensions}</p>
                        </div>
                    `;
                    resultsContainer.appendChild(resultCard);
                }
            });
        }

        // Show single file result
        function showResult(result) {
            try {
                console.log('Displaying result:', result);
                const resultsContainer = document.getElementById('results');
                
                if (!resultsContainer) {
                    console.error('Results container not found');
                    return;
                }
                
                // Create result card
                const resultCard = document.createElement('div');
                resultCard.className = 'result-card';
                
                // Determine if the result indicates a fake or real detection
                const isFake = result.prediction === 'fake' || result.prediction === 'Fake';
                const confidence = result.confidence ? 
                    `${(result.confidence * 100).toFixed(2)}%` : 'N/A';
                const fileType = result.file_type || 'file';
                const fileSize = result.file_size ? formatFileSize(result.file_size) : 'N/A';
                
                // Additional details if available
                let additionalDetails = '';
                if (result.details) {
                    additionalDetails = `
                        <p><strong>Details:</strong> ${result.details}</p>
                    `;
                }
                
                // Model information if available
                let modelInfo = '';
                if (result.model) {
                    modelInfo = `
                        <div class="model-info">
                            <h4>Model Information</h4>
                            <p><strong>Name:</strong> ${result.model.name || 'N/A'}</p>
                            <p><strong>Version:</strong> ${result.model.version || 'N/A'}</p>
                            <p><strong>Accuracy:</strong> ${result.model.accuracy ? 
                                `${(result.model.accuracy * 100).toFixed(2)}%` : 'N/A'}</p>
                        </div>
                    `;
                }
                
                // Set the HTML content
                resultCard.innerHTML = `
                    <div class="result-header">
                        <div class="result-status ${isFake ? 'fake' : 'real'}">
                            <i class="fas ${isFake ? 'fa-exclamation-triangle' : 'fa-check-circle'}" aria-hidden="true"></i>
                            ${isFake ? 'Fake' : 'Real'}
                            <span class="sr-only"> with ${confidence} confidence</span>
                        </div>
                    </div>
                    <div class="result-details">
                        <div class="result-meta">
                            <p><strong>Confidence:</strong> ${confidence}</p>
                            <p><strong>Confidence:</strong> 
                                <span class="confidence-value">${confidence}</span>
                                <span class="confidence-bar" style="width: ${result.confidence || 0}%"></span>
                            </p>
                            <p><strong>Type:</strong> ${fileType}</p>
                            <p><strong>Size:</strong> ${fileSize}</p>
                            ${additionalDetails}
                        </div>
                        ${modelInfo}
                    </div>
                `;
                
                // Add animation class for entrance
                resultCard.classList.add('result-enter');
                
                // Insert the new result at the top of the container
                resultsContainer.insertBefore(resultCard, resultsContainer.firstChild);
                
                // Set focus for better keyboard navigation
                resultCard.setAttribute('tabindex', '0');
                resultCard.focus();
                
                // Remove focus after interaction for better UX
                resultCard.addEventListener('blur', () => {
                    resultCard.removeAttribute('tabindex');
                }, { once: true });
                
                // Announce the result for screen readers
                announceResult(isFake, confidence, fileType);
                
            } catch (error) {
                console.error('Error displaying result:', error);
                showError('Failed to display the analysis result');
            }
        }
        
        // Function to announce results for screen readers
        function announceResult(isFake, confidence, fileType) {
            const announcement = document.createElement('div');
            announcement.className = 'sr-only';
            announcement.setAttribute('aria-live', 'polite');
            announcement.textContent = 
                `Analysis complete. The ${fileType} appears to be ${isFake ? 'fake' : 'real'} with ${confidence} confidence.`;
            
            document.body.appendChild(announcement);
            
            // Remove after announcement
            setTimeout(() => {
                document.body.removeChild(announcement);
            }, 1000);
        }
        
        // Helper function to format file sizes
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // Helper function to truncate long text
        function truncateText(text, maxLength) {
            if (text.length <= maxLength) return text;
            return text.substring(0, maxLength) + '...';
        }

        // Check system status
        async function checkSystemStatus() {
            try {
                const response = await fetch('/api/health');
                if (!response.ok) throw new Error('Network response was not ok');
                const data = await response.json();
                
                // Update status indicators in the UI if elements exist
                const systemStatusEl = document.getElementById('systemStatus');
                const statusTextEl = document.getElementById('statusText');
                const memoryGauge = document.getElementById('memoryGauge');
                const activeTasks = document.getElementById('activeTasks');
                
                if (systemStatusEl && statusTextEl) {
                    systemStatusEl.className = `status-indicator ${data.status === 'ok' ? 'success' : 'error'}`;
                    statusTextEl.textContent = data.status === 'ok' ? 'System Online' : 'System Offline';
                    statusTextEl.className = data.status === 'ok' ? 'text-success' : 'text-error';
                }
                
                if (systemStatusEl) {
                    systemStatusEl.textContent = 'Online';
                    systemStatusEl.style.color = '#2ecc71';
                }
                
                // Update memory gauge if element exists
                if (memoryGauge) {
                    memoryGauge.style.width = '0%'; // Reset or update based on actual data if available
                }
                
                // Update active tasks if element exists
                if (activeTasks) {
                    activeTasks.textContent = activeBatches.size || 0;
                }
            } catch (error) {
                console.error('Error checking system status:', error);
            }
        }
        
        // Setup upload area
        function setupUploadArea() {
            if (!uploadArea) return;
            
            // Set ARIA attributes for accessibility
            uploadArea.setAttribute('role', 'button');
            uploadArea.setAttribute('tabindex', '0');
            uploadArea.setAttribute('aria-label', 'Click or drop files here to upload');
        }
        
        // Setup focus trap for accessibility
        function setupFocusTrap() {
            // Implementation for focus trap if needed
            return true;
        }

        // Format file size
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / 1048576).toFixed(1) + ' MB';
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM fully loaded, initializing application...');
            try {
                // Initialize elements
                if (!initializeElements()) {
                    console.error('Failed to initialize elements');
                    return;
                }

                // Set up event listeners
                if (!setupEventListeners()) {
                    console.error('Failed to set up event listeners');
                    return;
                }

                // Set up analyze button
                setupAnalyzeButton();

                // Set up upload area
                setupUploadArea();

                // Check system status
                checkSystemStatus();

                console.log('Application initialized successfully');
            } catch (error) {
                console.error('Error initializing application:', error);
                showError('Failed to initialize the application. Please refresh the page.');
            }
        });
    </script>
</body>
</html>